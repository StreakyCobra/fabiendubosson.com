{{ define "main" }}
  <div class='hx-mx-auto hx-flex {{ partial "utils/page-width" . }}'>
    {{ partial "sidebar.html" (dict "context" . "disableSidebar" true "displayPlaceholder" true) }}
    {{ partial "toc.html" . }}
    <article class="hx-w-full hx-break-words hx-flex hx-min-h-[calc(100vh-var(--navbar-height))] hx-min-w-0 hx-justify-center hx-pb-8 hx-pr-[calc(env(safe-area-inset-right)-1.5rem)]">
      <main class="hx-w-full hx-min-w-0 hx-max-w-6xl hx-px-6 hx-pt-4 md:hx-px-12">
        {{ if .Title }}<h1 class="hx-text-center hx-mt-2 hx-text-4xl hx-font-bold hx-tracking-tight hx-text-slate-900 dark:hx-text-slate-100">{{ .Title }}</h1>{{ end }}
        <div class="hx-mt-8 content">
          {{ .Content }}
        </div>

        {{- $blogSection := site.Params.blogSection | default "blog" -}}
        {{- $recentPostsCount := .Site.Params.custom.recentPostsCount | default 3 -}}

        {{- $blogPages := where (.Site.RegularPages.ByDate.Reverse.Limit $recentPostsCount) "Type" "eq" $blogSection -}}
        {{- if $blogPages -}}
          <h3><a style="color: inherit; text-decoration: none;" class="hx-block hx-font-semibold hx-mt-8 hx-mb-2 hx-text-xl " href="/blog/">Recent blog posts</a></h3>
        {{- end -}}
        {{- range $blogPages }}
          <div class="hx-mb-4">
            {{ partial "shortcodes/card" (dict
              "title" (print (dateFormat "2006-01-02" .Date) " — " .Title)
              "icon" "document-text"
              "subtitle" (.Summary | plainify | htmlUnescape)
              "link" .RelPermalink
              "date" .Date
            ) }}
          </div>
        {{ end -}}

        {{- $seeAllPosts := (T "seeAllPosts") | default "See all posts →" -}}
        {{- if gt (len (where .Site.RegularPages "Type" "eq" $blogSection)) $recentPostsCount -}}
          <a class="hx-text-[color:hsl(var(--primary-hue),100%,50%)] hx-underline hx-underline-offset-2 hx-decoration-from-font" href="/blog/">
            {{- $seeAllPosts -}}
          </a>
        {{- end -}}

      </main>
    </article>
  </div>
{{ end }}
